<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sosigae.LuckeyTurkey.dao.mybatis.mapper.DoctorMapper">

        <cache />

        <!-- 의사가 특정 환자 백신 접종 현황 확인 -->
        <select id="getVacRecordByUser" resultType="com.sosigae.LuckeyTurkey.domain.VaccinationRecord">
            SELECT * FROM VaccinationRecord WHERE user_id = #{user_id}
        </select>

        <!-- 의사가 특정 환자 약물 복용기록 확인 -->
        <select id="getMedByUser" resultType="com.sosigae.LuckeyTurkey.domain.Medication">
            SELECT * FROM Medication WHERE user_id = #{user_id}
        </select>

        <!-- 의사가 특정 환자 진료 기록 추가 -->
        <insert id="addMedRecord">
            INSERT INTO MedicalRecord (doctor_id, user_id, content)
            VALUES (#{doctor_id}, #{user_id}, #{content})
        </insert>

        <!-- 의사가 본인이 진료한 모든 환자 진료 기록 확인 -->
        <select id="getMedRecordList" resultType="com.sosigae.LuckeyTurkey.domain.MedicalRecord">
            SELECT * FROM MedicalRecord WHERE user_id = #{doctor_id}
        </select>

        <!-- 의사가 특정 환자 진료 기록 수정 -->
        <update id="updateMedRecord">
            UPDATE MedicalRecord SET content = #{content}
            WHERE doctor_id = #{doctor_id}
              AND user_id = #{user_id}
        </update>

<!--    의사 검색 -->
    <select id="searchDoctors" resultType="com.sosigae.LuckeyTurkey.domain.Doctor">
        SELECT * FROM Doctor
        WHERE (#{name} IS NULL OR name LIKE CONCAT('%', #{name}, '%'))
          AND (#{department} IS NULL OR department = #{department})
    </select>

    <select id="searchDoctorsByNameAndDepartment" resultType="com.sosigae.LuckeyTurkey.domain.Doctor">
        SELECT d.doctor_id AS doctorId, d.hospital_id AS hospitalId, d.id, d.password, d.name, d.department,
               d.is_admin AS isAdmin, d.former_hospital AS formerHospital, d.email, d.phone,
               h.name AS hospitalName, h.address AS hospitalAddress
        FROM Doctor d
                 JOIN Hospital h ON d.hospital_id = h.hospital_id
        WHERE d.name LIKE '%' || #{name, jdbcType=VARCHAR} || '%'
          AND d.department = #{department, jdbcType=VARCHAR}
    </select>

    <select id="searchDoctorsByName" resultType="com.sosigae.LuckeyTurkey.domain.Doctor">
        SELECT d.doctor_id AS doctorId, d.hospital_id AS hospitalId, d.id, d.password, d.name, d.department,
               d.is_admin AS isAdmin, d.former_hospital AS formerHospital, d.email, d.phone,
               h.name AS hospitalName, h.address AS hospitalAddress
        FROM Doctor d
                 JOIN Hospital h ON d.hospital_id = h.hospital_id
        WHERE d.name LIKE '%' || #{name, jdbcType=VARCHAR} || '%'
    </select>

    <select id="searchDoctorsByDepartment" resultType="com.sosigae.LuckeyTurkey.domain.Doctor">
        SELECT d.doctor_id AS doctorId, d.hospital_id AS hospitalId, d.id, d.password, d.name, d.department,
               d.is_admin AS isAdmin, d.former_hospital AS formerHospital, d.email, d.phone,
               h.name AS hospitalName, h.address AS hospitalAddress
        FROM Doctor d
                 JOIN Hospital h ON d.hospital_id = h.hospital_id
        WHERE d.department = #{department, jdbcType=VARCHAR}
    </select>


    <!-- 특정 의사 정보 확인 -->
    <select id="getDocInfo" resultType="com.sosigae.LuckeyTurkey.domain.Doctor">
        SELECT * FROM Doctor WHERE doctor_id = #{doctor_id}
    </select>

<!--    전체 의사 목록 -->
    <select id="getAllDoctors" resultType="com.sosigae.LuckeyTurkey.domain.Doctor">
        SELECT d.*, h.name AS hospitalName, h.address AS hospitalAddress
        FROM Doctor d
                 JOIN Hospital h ON d.hospital_id = h.hospital_id
    </select>
    </mapper>
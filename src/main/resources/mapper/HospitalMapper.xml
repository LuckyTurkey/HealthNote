<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sosigae.LuckeyTurkey.mapper.HospitalMapper">

  <cache />
  <!-- 병원 정보 추가 -->
  <insert id="addHospitalInfo">
    INSERT INTO Hospital (hospital_id, name, address, open_time, close_time, sat_open_time, sat_close_time)
    VALUES (#{hospital_id}, #{name}, #{address}, #{open_time}, #{close_time}, #{sat_open_time}, #{sat_close_time})
  </insert>

  <!-- 병원 정보 확인 -->
  <select id="getHospitalInfo" resultType="com.sosigae.LuckeyTurkey.domain.Hospital">
    SELECT * FROM Hospital WHERE hospital_id = #{hospital_id}
  </select>

<!--  병원 검색 -->
<!--  <select id="searchHospitals" resultType="Hospital">-->
<!--    SELECT * FROM Hospital WHERE name LIKE CONCAT('%', #{name}, '%')-->
<!--  </select>-->

  <select id="searchHospitals" resultType="com.sosigae.LuckeyTurkey.domain.Hospital">
    SELECT * FROM Hospital
    WHERE (#{name} IS NULL OR name LIKE CONCAT('%', #{name}, '%'))
      AND (#{department} IS NULL OR department = #{department})
  </select>

  <!-- 병원 정보 수정 -->
  <update id="updateHospitalInfo">
    UPDATE Hospital
    SET name = #{name}, address = #{address}, open_time = #{open_time}, close_time = #{close_time}, sat_open_time = #{sat_open_time}, sat_close_time = #{sat_close_time}
    WHERE hospital_id = #{hospital_id}
  </update>

  <!-- 해당 병원에서 근무하는 의사 정보 추가 -->
  <insert id="addDocInfo">
    INSERT INTO Doctor (doctor_id, id, password, hospital_id, name, department, is_admin, former_hospital, email, phone)
    VALUES (#{doctor_id}, #{id}, #{password}, #{hospital_id}, #{name}, #{department}, #{is_admin}, #{hospital_id}, #{email}, #{phone})
  </insert>

  <!-- 해당 병원에서 근무하는 모든 의사들 정보 확인 -->
  <select id="getDocInfoList" resultType="com.sosigae.LuckeyTurkey.domain.Doctor">
    SELECT * FROM Doctor WHERE hospital_id = #{hospital_id}
  </select>

  <!-- 해당 병원에서 근무하는 특정 의사 정보 확인 -->
  <select id="getDocInfo" resultType="com.sosigae.LuckeyTurkey.domain.Doctor">
    SELECT * FROM Doctor WHERE doctor_id = #{doctor_id}
  </select>

  <!-- 해당 병원에서 근무하는 특정 의사 정보 수정 -->
  <update id="updateDocInfo">
    UPDATE Doctor
    SET name = #{name}, department = #{department}, former_hospital = #{hospital_id}, email = #{email}, phone = #{phone}
    WHERE doctor_id = #{doctor_id}
  </update>

  <!-- 해당 병원에서 근무하는 특정 의사 정보 삭제 -->
  <delete id="deleteDocInfo">
    UPDATE Doctor
    SET hospital_id = #{hospital_id}
    WHERE doctor_id = #{doctor_id}
  </delete>

  <!-- 해당 병원에서 예약 스케줄 추가 -->
  <insert id="addReservation">
    INSERT INTO Reservation (hospital_id, doctor_id, user_id, date, time)
    VALUES (#{hospital_id}, #{doctor_id}, #{user_id}, #{date}, #{time})
  </insert>

  <!-- 해당 병원에서 예약 스케줄 확인 -->
  <select id="getReservation" resultType="com.sosigae.LuckeyTurkey.domain.Reservation">
    SELECT * FROM Reservation WHERE hospital_id = #{hospital_id}
  </select>

  <!-- 해당 병원에서 예약 스케줄 수정 -->
  <update id="updateReservation">
    UPDATE Reservation SET date = #{date}, time = #{time}
    WHERE hospital_id = #{hospital_id}
	    AND doctor_id = #{doctor_id}
	    AND user_id = #{user_id}
  </update>

  <!-- 해당 병원에서 예약 스케줄 삭제 -->
  <delete id="deleteReservation">
    DELETE FROM Reservation
    WHERE hospital_id = #{hospital_id}
	    AND doctor_id = #{doctor_id}
		  AND user_id = #{user_id}
  </delete>

  <!-- 해당 병원에서 진행된 모든 진료 기록 리스트로 확인 -->
  <select id="getMedRecordList" resultType="com.sosigae.LuckeyTurkey.domain.MedicalRecord">
    SELECT * FROM MedicalRecord WHERE hospital_id = #{hospital_id}
  </select>

  <!-- 해당 병원에서 진행된 특정 진료 기록 확인 -->
  <select id="getMedRecord" resultType="com.sosigae.LuckeyTurkey.domain.MedicalRecord">
    SELECT * FROM MedicalRecord WHERE medical_record_id = #{medical_record_id}
  </select>

</mapper>